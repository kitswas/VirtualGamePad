<style>
  .lang-switcher-dropdown {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 9999;
    background: var(--body-bg);
    border: 2px solid var(--border-color);
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 1em;
  }
  .lang-switcher-dropdown-content {
    display: none;
    position: absolute;
    right: 0;
    background: var(--body-bg);
    min-width: 120px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    border-radius: 4px;
    margin-top: 2px;
  }
  .lang-switcher-dropdown:hover .lang-switcher-dropdown-content {
    display: block;
  }
  .lang-switcher-dropdown-content a {
    display: block;
    padding: 6px 12px;
    text-decoration: none;
    color: var(--body-color);
  }
  .lang-switcher-dropdown-content a.active {
    font-weight: bold;
    background: var(--gray-bg);
  }
</style>

<meta
  http-equiv="Content-Language"
  content="{{ page.lang | default: site.active_lang | default: site.default_lang }}"
/>

{%- assign current_lang = page.lang | default: site.active_lang | default: site.default_lang -%}
{%- assign stub = page.url | default: '/' -%}
{%- comment -%} Strip the current language prefix so we can rebuild URLs per language. {%- endcomment -%}
{%- if stub == '' -%}{%- assign stub = '/' -%}{%- endif -%}
{%- for lang in site.languages -%}
  {%- assign prefix = '/' | append: lang -%}
  {%- assign parts = stub | split: prefix -%}
  {%- if parts[0] == '' -%}
    {%- assign stub = parts[1] | default: '/' -%}
    {%- if stub == '' -%}{%- assign stub = '/' -%}{%- endif -%}
    {%- break -%}
  {%- endif -%}
{%- endfor -%}

<link rel="canonical" href="{{ page.url | absolute_url }}" />

{% for lang in site.languages %}
  {%- assign lang_href = '/' | append: lang -%}
  {%- if stub == '/' -%}
    {%- assign lang_href = lang_href | append: '/' -%}
  {%- else -%}
    {%- assign lang_href = lang_href | append: stub -%}
  {%- endif -%}
  <link rel="alternate" hreflang="{{ lang }}" href="{{ lang_href | absolute_url }}" />
  {%- if lang == site.default_lang -%}
    <link rel="alternate" hreflang="x-default" href="{{ lang_href | absolute_url }}" />
  {%- endif -%}
{% endfor %}

<div class="lang-switcher-dropdown" role="navigation" aria-label="Language selector">
  <span style="cursor: pointer">Language</span>
  <div class="lang-switcher-dropdown-content">
    {% for lang in site.languages %}
      {%- assign lang_href = '/' | append: lang -%}
      {%- if stub == '/' -%}
        {%- assign lang_href = lang_href | append: '/' -%}
      {%- else -%}
        {%- assign lang_href = lang_href | append: stub -%}
      {%- endif -%}
      <a href="{{ lang_href | relative_url }}" {% if current_lang == lang %}class="active"{% endif %}>{{ lang }}</a>
    {% endfor %}
  </div>
</div>
